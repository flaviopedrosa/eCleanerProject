{"version":3,"file":"QForm-EnGPGASW.js","sources":["../../../node_modules/quasar/src/components/form/QForm.js"],"sourcesContent":["import { h, ref, onActivated, onDeactivated, onMounted, getCurrentInstance, nextTick, provide } from 'vue'\n\nimport { createComponent } from '../../utils/private.create/create.js'\nimport { stopAndPrevent } from '../../utils/event/event.js'\nimport { addFocusFn } from '../../utils/private.focus/focus-manager.js'\nimport { hSlot } from '../../utils/private.render/render.js'\nimport { formKey } from '../../utils/private.symbols/symbols.js'\nimport { vmIsDestroyed } from '../../utils/private.vm/vm.js'\n\nexport default createComponent({\n  name: 'QForm',\n\n  props: {\n    autofocus: Boolean,\n    noErrorFocus: Boolean,\n    noResetFocus: Boolean,\n    greedy: Boolean,\n\n    onSubmit: Function\n  },\n\n  emits: [ 'reset', 'validationSuccess', 'validationError' ],\n\n  setup (props, { slots, emit }) {\n    const vm = getCurrentInstance()\n    const rootRef = ref(null)\n\n    let validateIndex = 0\n    const registeredComponents = []\n\n    function validate (shouldFocus) {\n      const focus = typeof shouldFocus === 'boolean'\n        ? shouldFocus\n        : props.noErrorFocus !== true\n\n      const index = ++validateIndex\n\n      const emitEvent = (res, ref) => {\n        emit(`validation${ res === true ? 'Success' : 'Error' }`, ref)\n      }\n\n      const validateComponent = comp => {\n        const valid = comp.validate()\n\n        return typeof valid.then === 'function'\n          ? valid.then(\n            valid => ({ valid, comp }),\n            err => ({ valid: false, comp, err })\n          )\n          : Promise.resolve({ valid, comp })\n      }\n\n      const errorsPromise = props.greedy === true\n        ? Promise\n          .all(registeredComponents.map(validateComponent))\n          .then(res => res.filter(r => r.valid !== true))\n        : registeredComponents\n          .reduce(\n            (acc, comp) => acc.then(() => {\n              return validateComponent(comp).then(r => {\n                if (r.valid === false) { return Promise.reject(r) }\n              })\n            }),\n            Promise.resolve()\n          )\n          .catch(error => [ error ])\n\n      return errorsPromise.then(errors => {\n        if (errors === void 0 || errors.length === 0) {\n          index === validateIndex && emitEvent(true)\n          return true\n        }\n\n        // if not outdated already\n        if (index === validateIndex) {\n          const { comp, err } = errors[ 0 ]\n\n          err !== void 0 && console.error(err)\n          emitEvent(false, comp)\n\n          if (focus === true) {\n            // Try to focus first mounted and active component\n            const activeError = errors.find(({ comp }) => (\n              typeof comp.focus === 'function'\n              && vmIsDestroyed(comp.$) === false\n            ))\n\n            if (activeError !== void 0) {\n              activeError.comp.focus()\n            }\n          }\n        }\n\n        return false\n      })\n    }\n\n    function resetValidation () {\n      validateIndex++\n\n      registeredComponents.forEach(comp => {\n        typeof comp.resetValidation === 'function' && comp.resetValidation()\n      })\n    }\n\n    function submit (evt) {\n      evt !== void 0 && stopAndPrevent(evt)\n\n      const index = validateIndex + 1\n\n      validate().then(val => {\n        // if not outdated && validation succeeded\n        if (index === validateIndex && val === true) {\n          if (props.onSubmit !== void 0) {\n            emit('submit', evt)\n          }\n          else if (evt?.target !== void 0 && typeof evt.target.submit === 'function') {\n            evt.target.submit()\n          }\n        }\n      })\n    }\n\n    function reset (evt) {\n      evt !== void 0 && stopAndPrevent(evt)\n\n      emit('reset')\n\n      nextTick(() => { // allow userland to reset values before\n        resetValidation()\n        if (props.autofocus === true && props.noResetFocus !== true) {\n          focus()\n        }\n      })\n    }\n\n    function focus () {\n      addFocusFn(() => {\n        if (rootRef.value === null) return\n\n        const target = rootRef.value.querySelector('[autofocus][tabindex], [data-autofocus][tabindex]')\n          || rootRef.value.querySelector('[autofocus] [tabindex], [data-autofocus] [tabindex]')\n          || rootRef.value.querySelector('[autofocus], [data-autofocus]')\n          || Array.prototype.find.call(rootRef.value.querySelectorAll('[tabindex]'), el => el.tabIndex !== -1)\n\n        target?.focus({ preventScroll: true })\n      })\n    }\n\n    provide(formKey, {\n      bindComponent (vmProxy) {\n        registeredComponents.push(vmProxy)\n      },\n\n      unbindComponent (vmProxy) {\n        const index = registeredComponents.indexOf(vmProxy)\n        if (index !== -1) {\n          registeredComponents.splice(index, 1)\n        }\n      }\n    })\n\n    let shouldActivate = false\n\n    onDeactivated(() => {\n      shouldActivate = true\n    })\n\n    onActivated(() => {\n      shouldActivate === true && props.autofocus === true && focus()\n    })\n\n    onMounted(() => {\n      props.autofocus === true && focus()\n    })\n\n    // expose public methods\n    Object.assign(vm.proxy, {\n      validate,\n      resetValidation,\n      submit,\n      reset,\n      focus,\n      getValidationComponents: () => registeredComponents\n    })\n\n    return () => h('form', {\n      class: 'q-form',\n      ref: rootRef,\n      onSubmit: submit,\n      onReset: reset\n    }, hSlot(slots.default))\n  }\n})\n"],"names":["focus","ref","valid","comp"],"mappings":"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","x_google_ignoreList":[0]}