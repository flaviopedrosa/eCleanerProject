{"version":3,"file":"QImg-DiYq_5sI.js","sources":["../../../node_modules/quasar/src/composables/private.use-ratio/use-ratio.js","../../../node_modules/quasar/src/components/img/QImg.js"],"sourcesContent":["import { computed } from 'vue'\n\nexport const useRatioProps = {\n  ratio: [ String, Number ]\n}\n\nexport default function (props, naturalRatio) {\n  // return ratioStyle\n  return computed(() => {\n    const ratio = Number(\n      props.ratio || (naturalRatio !== void 0 ? naturalRatio.value : void 0)\n    )\n\n    return isNaN(ratio) !== true && ratio > 0\n      ? { paddingBottom: `${ 100 / ratio }%` }\n      : null\n  })\n}\n","import { h, ref, computed, watch, onMounted, Transition, getCurrentInstance } from 'vue'\n\nimport QSpinner from '../spinner/QSpinner.js'\n\nimport { isRuntimeSsrPreHydration } from '../../plugins/platform/Platform.js'\nimport useRatio, { useRatioProps } from '../../composables/private.use-ratio/use-ratio.js'\n\nimport { createComponent } from '../../utils/private.create/create.js'\nimport { hSlot } from '../../utils/private.render/render.js'\nimport { vmIsDestroyed } from '../../utils/private.vm/vm.js'\nimport useTimeout from '../../composables/use-timeout/use-timeout.js'\n\nconst defaultRatio = 1.7778 /* 16/9 */\n\nexport default createComponent({\n  name: 'QImg',\n\n  props: {\n    ...useRatioProps,\n\n    src: String,\n    srcset: String,\n    sizes: String,\n\n    alt: String,\n    crossorigin: String,\n    decoding: String,\n    referrerpolicy: String,\n\n    draggable: Boolean,\n\n    loading: {\n      type: String,\n      default: 'lazy'\n    },\n    loadingShowDelay: {\n      type: [ Number, String ],\n      default: 0\n    },\n\n    fetchpriority: {\n      type: String,\n      default: 'auto'\n    },\n    width: String,\n    height: String,\n    initialRatio: {\n      type: [ Number, String ],\n      default: defaultRatio\n    },\n\n    placeholderSrc: String,\n    errorSrc: String,\n\n    fit: {\n      type: String,\n      default: 'cover'\n    },\n    position: {\n      type: String,\n      default: '50% 50%'\n    },\n\n    imgClass: String,\n    imgStyle: Object,\n\n    noSpinner: Boolean,\n    noNativeMenu: Boolean,\n    noTransition: Boolean,\n\n    spinnerColor: String,\n    spinnerSize: String\n  },\n\n  emits: [ 'load', 'error' ],\n\n  setup (props, { slots, emit }) {\n    const naturalRatio = ref(props.initialRatio)\n    const ratioStyle = useRatio(props, naturalRatio)\n    const vm = getCurrentInstance()\n\n    const { registerTimeout: registerLoadTimeout, removeTimeout: removeLoadTimeout } = useTimeout()\n    const { registerTimeout: registerLoadShowTimeout, removeTimeout: removeLoadShowTimeout } = useTimeout()\n\n    const placeholderImg = computed(() => (\n      props.placeholderSrc !== void 0\n        ? { src: props.placeholderSrc }\n        : null\n    ))\n\n    const errorImg = computed(() => (\n      props.errorSrc !== void 0\n        ? { src: props.errorSrc, __qerror: true }\n        : null\n    ))\n\n    const images = [\n      ref(null),\n      ref(placeholderImg.value)\n    ]\n\n    const position = ref(0)\n\n    const isLoading = ref(false)\n    const hasError = ref(false)\n\n    const classes = computed(() =>\n      `q-img q-img--${ props.noNativeMenu === true ? 'no-' : '' }menu`\n    )\n\n    const style = computed(() => ({\n      width: props.width,\n      height: props.height\n    }))\n\n    const imgClass = computed(() =>\n      `q-img__image ${ props.imgClass !== void 0 ? props.imgClass + ' ' : '' }`\n      + `q-img__image--with${ props.noTransition === true ? 'out' : '' }-transition`\n      + ' q-img__image--'\n    )\n\n    const imgStyle = computed(() => ({\n      ...props.imgStyle,\n      objectFit: props.fit,\n      objectPosition: props.position\n    }))\n\n    function setLoading () {\n      removeLoadShowTimeout()\n\n      if (props.loadingShowDelay === 0) {\n        isLoading.value = true\n        return\n      }\n\n      registerLoadShowTimeout(() => {\n        isLoading.value = true\n      }, props.loadingShowDelay)\n    }\n\n    function clearLoading () {\n      removeLoadShowTimeout()\n      isLoading.value = false\n    }\n\n    function onLoad ({ target }) {\n      if (vmIsDestroyed(vm) === false) {\n        removeLoadTimeout()\n\n        naturalRatio.value = target.naturalHeight === 0\n          ? 0.5\n          : target.naturalWidth / target.naturalHeight\n\n        waitForCompleteness(target, 1)\n      }\n    }\n\n    function waitForCompleteness (target, count) {\n      // protect against running forever\n      if (count === 1000 || vmIsDestroyed(vm) === true) return\n\n      if (target.complete === true) {\n        onReady(target)\n      }\n      else {\n        registerLoadTimeout(() => {\n          waitForCompleteness(target, count + 1)\n        }, 50)\n      }\n    }\n\n    function onReady (target) {\n      if (vmIsDestroyed(vm) === true) return\n\n      position.value = position.value ^ 1\n      images[ position.value ].value = null\n\n      clearLoading()\n\n      if (target.getAttribute('__qerror') !== 'true') {\n        hasError.value = false\n      }\n\n      emit('load', target.currentSrc || target.src)\n    }\n\n    function onError (err) {\n      removeLoadTimeout()\n      clearLoading()\n\n      hasError.value = true\n      images[ position.value ].value = errorImg.value\n      images[ position.value ^ 1 ].value = placeholderImg.value\n\n      emit('error', err)\n    }\n\n    function getImage (index) {\n      const img = images[ index ].value\n\n      const data = {\n        key: 'img_' + index,\n        class: imgClass.value,\n        style: imgStyle.value,\n        alt: props.alt,\n        crossorigin: props.crossorigin,\n        decoding: props.decoding,\n        referrerpolicy: props.referrerpolicy,\n        height: props.height,\n        width: props.width,\n        loading: props.loading,\n        fetchpriority: props.fetchpriority,\n        'aria-hidden': 'true',\n        draggable: props.draggable,\n        ...img\n      }\n\n      if (position.value === index) {\n        Object.assign(data, {\n          class: data.class + 'current',\n          onLoad,\n          onError\n        })\n      }\n      else {\n        data.class += 'loaded'\n      }\n\n      return h(\n        'div',\n        { class: 'q-img__container absolute-full', key: 'img' + index },\n        h('img', data)\n      )\n    }\n\n    function getContent () {\n      if (isLoading.value === false) {\n        return h('div', {\n          key: 'content',\n          class: 'q-img__content absolute-full q-anchor--skip'\n        }, hSlot(slots[ hasError.value === true ? 'error' : 'default' ]))\n      }\n\n      return h('div', {\n        key: 'loading',\n        class: 'q-img__loading absolute-full flex flex-center'\n      }, (\n        slots.loading !== void 0\n          ? slots.loading()\n          : (\n              props.noSpinner === true\n                ? void 0\n                : [\n                    h(QSpinner, {\n                      color: props.spinnerColor,\n                      size: props.spinnerSize\n                    })\n                  ]\n            )\n      ))\n    }\n\n    if (__QUASAR_SSR_SERVER__ !== true) {\n      function watchSrc () {\n        watch(\n          () => (\n            props.src || props.srcset || props.sizes\n              ? {\n                  src: props.src,\n                  srcset: props.srcset,\n                  sizes: props.sizes\n                }\n              : null\n          ),\n          imgProps => {\n            removeLoadTimeout()\n            hasError.value = false\n\n            if (imgProps === null) {\n              clearLoading()\n              images[ position.value ^ 1 ].value = placeholderImg.value\n            }\n            else {\n              setLoading()\n            }\n\n            images[ position.value ].value = imgProps\n          },\n          { immediate: true }\n        )\n      }\n\n      if (isRuntimeSsrPreHydration.value === true) {\n        onMounted(watchSrc)\n      }\n      else {\n        watchSrc()\n      }\n    }\n\n    return () => {\n      const content = []\n\n      if (ratioStyle.value !== null) {\n        content.push(\n          h('div', { key: 'filler', style: ratioStyle.value })\n        )\n      }\n\n      if (images[ 0 ].value !== null) {\n        content.push(\n          getImage(0)\n        )\n      }\n\n      if (images[ 1 ].value !== null) {\n        content.push(\n          getImage(1)\n        )\n      }\n\n      content.push(\n        h(Transition, { name: 'q-transition--fade' }, getContent)\n      )\n\n      return h('div', {\n        key: 'main',\n        class: classes.value,\n        style: style.value,\n        role: 'img',\n        'aria-label': props.alt\n      }, content)\n    }\n  }\n})\n"],"names":[],"mappings":"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","x_google_ignoreList":[0,1]}