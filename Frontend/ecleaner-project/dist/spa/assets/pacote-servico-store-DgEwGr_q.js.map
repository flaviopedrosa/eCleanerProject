{"version":3,"file":"pacote-servico-store-DgEwGr_q.js","sources":["../../../src/core/infrastructure/repositories/pacoteServicoRepository.js","../../../src/stores/pacote-servico-store.js"],"sourcesContent":["import { PacoteServico } from '../../domain/entities/pacoteServico.js'\n\n/**\n * Repositório para gerenciar os pacotes de serviços no localStorage\n */\nexport class PacoteServicoRepository {\n  constructor() {\n    this.storageKey = 'ecleaner_pacotes_servicos'\n  }\n\n  /**\n   * Salva todos os pacotes\n   */\n  salvarTodos(pacotes) {\n    const pacotesJson = pacotes.map((pacote) => this._pacoteToJson(pacote))\n    localStorage.setItem(this.storageKey, JSON.stringify(pacotesJson))\n  }\n\n  /**\n   * Busca todos os pacotes\n   */\n  buscarTodos() {\n    const pacotesJson = JSON.parse(localStorage.getItem(this.storageKey) || '[]')\n    return pacotesJson.map((pacoteData) => this._jsonToPacote(pacoteData))\n  }\n\n  /**\n   * Busca pacote por ID\n   */\n  buscarPorId(id) {\n    const pacotes = this.buscarTodos()\n    return pacotes.find((pacote) => pacote.Id === id)\n  }\n\n  /**\n   * Busca pacotes favoritos\n   */\n  buscarFavoritos() {\n    const pacotes = this.buscarTodos()\n    return pacotes.filter((pacote) => pacote.Favorito)\n  }\n\n  /**\n   * Adiciona um novo pacote\n   */\n  adicionar(pacote) {\n    const pacotes = this.buscarTodos()\n\n    // Garantir que tem um ID único\n    if (!pacote.Id || pacote.Id === null) {\n      pacote.Id = Date.now().toString()\n    }\n\n    // Recalcular valores antes de salvar\n    pacote.recalcularValores()\n\n    pacotes.push(pacote)\n    this.salvarTodos(pacotes)\n    return pacote\n  }\n\n  /**\n   * Atualiza um pacote existente\n   */\n  atualizar(pacoteAtualizado) {\n    const pacotes = this.buscarTodos()\n    const index = pacotes.findIndex((pacote) => pacote.Id === pacoteAtualizado.Id)\n\n    if (index !== -1) {\n      // Recalcular valores antes de salvar\n      pacoteAtualizado.recalcularValores()\n      pacotes[index] = pacoteAtualizado\n      this.salvarTodos(pacotes)\n      return pacoteAtualizado\n    }\n\n    throw new Error('Pacote não encontrado')\n  }\n\n  /**\n   * Remove um pacote\n   */\n  remover(id) {\n    const pacotes = this.buscarTodos()\n    const pacotesFiltrados = pacotes.filter((pacote) => pacote.Id !== id)\n\n    if (pacotesFiltrados.length < pacotes.length) {\n      this.salvarTodos(pacotesFiltrados)\n      return true\n    }\n\n    return false\n  }\n\n  /**\n   * Limpa todos os pacotes\n   */\n  limparTodos() {\n    localStorage.removeItem(this.storageKey)\n  }\n\n  /**\n   * Conta total de pacotes\n   */\n  contar() {\n    return this.buscarTodos().length\n  }\n\n  /**\n   * Alterna status de favorito\n   */\n  toggleFavorito(id) {\n    const pacotes = this.buscarTodos()\n    const pacote = pacotes.find((p) => p.Id === id)\n\n    if (pacote) {\n      pacote.Favorito = !pacote.Favorito\n      this.salvarTodos(pacotes)\n      return pacote\n    }\n\n    throw new Error('Pacote não encontrado')\n  }\n\n  /**\n   * Converte pacote para JSON serializable\n   */\n  _pacoteToJson(pacote) {\n    return {\n      Id: pacote.Id,\n      Descricao: pacote.Descricao,\n      MargemLucro: pacote.MargemLucro,\n      Favorito: pacote.Favorito,\n      ItensMaterial: pacote.ItensMaterial || [],\n      ItensServico: pacote.ItensServico || [],\n      ValorMaterial: pacote.ValorMaterial,\n      ValorServico: pacote.ValorServico,\n      ValorTotal: pacote.ValorTotal,\n      ValorVenda: pacote.ValorVenda,\n      CriadoEm: pacote.CriadoEm || new Date().toISOString(),\n      AtualizadoEm: pacote.AtualizadoEm || new Date().toISOString(),\n    }\n  }\n\n  /**\n   * Converte JSON para instância de PacoteServico\n   */\n  _jsonToPacote(data) {\n    const pacote = new PacoteServico(data.Descricao, data.MargemLucro)\n\n    // Preservar o ID original se existir\n    if (data.Id) {\n      pacote.Id = data.Id\n    }\n\n    pacote.Favorito = data.Favorito || false\n    pacote.ItensMaterial = data.ItensMaterial || []\n    pacote.ItensServico = data.ItensServico || []\n    pacote.ValorMaterial = data.ValorMaterial || 0\n    pacote.ValorServico = data.ValorServico || 0\n    pacote.ValorTotal = data.ValorTotal || 0\n    pacote.ValorVenda = data.ValorVenda || 0\n    pacote.CriadoEm = data.CriadoEm\n    pacote.AtualizadoEm = data.AtualizadoEm\n\n    return pacote\n  }\n}\n\n// Instância singleton do repositório\nexport const pacoteServicoRepository = new PacoteServicoRepository()\n","import { defineStore } from 'pinia'\nimport { PacoteServico } from '@/core/domain/entities/pacoteServico'\nimport { pacoteServicoRepository } from '@/core/infrastructure/repositories/pacoteServicoRepository'\n\nexport const usePacoteServicoStore = defineStore('pacoteServico', {\n  state: () => ({\n    pacotes: [],\n    loading: false,\n    error: null,\n  }),\n  actions: {\n    async fetchPacotes() {\n      this.loading = true\n      try {\n        // Busca os pacotes do localStorage através do repositório\n        this.pacotes = pacoteServicoRepository.buscarTodos()\n        this.error = null\n      } catch (e) {\n        this.error = e.message\n        console.error('Erro ao buscar pacotes:', e)\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async addPacote(pacote) {\n      this.loading = true\n      try {\n        // Criar instância do pacote\n        const novoPacote = new PacoteServico(pacote.Descricao, pacote.MargemLucro)\n        novoPacote.ItensMaterial = pacote.ItensMaterial || []\n        novoPacote.ItensServico = pacote.ItensServico || []\n        novoPacote.Favorito = pacote.Favorito || false\n\n        // Salvar no repositório\n        const pacoteSalvo = pacoteServicoRepository.adicionar(novoPacote)\n\n        // Atualizar store\n        this.pacotes.push(pacoteSalvo)\n        this.error = null\n      } catch (e) {\n        this.error = e.message\n        console.error('Erro ao adicionar pacote:', e)\n        throw e\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async updatePacote(pacote) {\n      try {\n        // Criar instância do pacote com dados atualizados\n        const pacoteInstance = new PacoteServico(pacote.Descricao, pacote.MargemLucro)\n        pacoteInstance.Id = pacote.Id\n        pacoteInstance.ItensMaterial = pacote.ItensMaterial || []\n        pacoteInstance.ItensServico = pacote.ItensServico || []\n        pacoteInstance.Favorito = pacote.Favorito || false\n\n        // Atualizar no repositório\n        const pacoteAtualizado = pacoteServicoRepository.atualizar(pacoteInstance)\n\n        // Atualizar store\n        const index = this.pacotes.findIndex((p) => p.Id === pacote.Id)\n        if (index !== -1) {\n          this.pacotes[index] = pacoteAtualizado\n        }\n\n        this.error = null\n      } catch (e) {\n        this.error = e.message\n        console.error('Erro ao atualizar pacote:', e)\n        throw e\n      }\n    },\n\n    async deletePacote(id) {\n      try {\n        // Remover do repositório\n        const removido = pacoteServicoRepository.remover(id)\n\n        if (removido) {\n          // Atualizar store\n          this.pacotes = this.pacotes.filter((p) => p.Id !== id)\n        }\n\n        this.error = null\n      } catch (e) {\n        this.error = e.message\n        console.error('Erro ao deletar pacote:', e)\n        throw e\n      }\n    },\n\n    getPacoteById(id) {\n      return this.pacotes.find((p) => p.Id === id)\n    },\n\n    async toggleFavorito(id) {\n      try {\n        // Alterar favorito no repositório\n        const pacoteAtualizado = pacoteServicoRepository.toggleFavorito(id)\n\n        // Atualizar store\n        const index = this.pacotes.findIndex((p) => p.Id === id)\n        if (index !== -1) {\n          this.pacotes[index] = pacoteAtualizado\n        }\n\n        this.error = null\n      } catch (e) {\n        this.error = e.message\n        console.error('Erro ao alterar favorito:', e)\n        throw e\n      }\n    },\n  },\n\n  getters: {\n    pacotesSortedByDescricao: (state) => {\n      return [...state.pacotes].sort((a, b) => a.Descricao.localeCompare(b.Descricao))\n    },\n\n    pacotesFavoritos: (state) => {\n      return state.pacotes.filter((pacote) => pacote.Favorito)\n    },\n\n    totalPacotes: (state) => state.pacotes.length,\n\n    totalPacotesFavoritos: (state) => {\n      return state.pacotes.filter((pacote) => pacote.Favorito).length\n    },\n\n    valorTotalTodosPacotes: (state) => {\n      return state.pacotes.reduce((total, pacote) => total + pacote.ValorVenda, 0)\n    },\n  },\n})\n"],"names":[],"mappings":"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"}