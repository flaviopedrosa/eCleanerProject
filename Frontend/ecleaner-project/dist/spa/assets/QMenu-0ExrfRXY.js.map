{"version":3,"file":"QMenu-0ExrfRXY.js","sources":["../../../node_modules/quasar/src/components/menu/QMenu.js"],"sourcesContent":["import { h, ref, computed, watch, Transition, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport useAnchor, { useAnchorProps } from '../../composables/private.use-anchor/use-anchor.js'\nimport useScrollTarget from '../../composables/private.use-scroll-target/use-scroll-target.js'\nimport useModelToggle, { useModelToggleProps, useModelToggleEmits } from '../../composables/private.use-model-toggle/use-model-toggle.js'\nimport useDark, { useDarkProps } from '../../composables/private.use-dark/use-dark.js'\nimport usePortal from '../../composables/private.use-portal/use-portal.js'\nimport useTransition, { useTransitionProps } from '../../composables/private.use-transition/use-transition.js'\nimport useTick from '../../composables/use-tick/use-tick.js'\nimport useTimeout from '../../composables/use-timeout/use-timeout.js'\n\nimport { createComponent } from '../../utils/private.create/create.js'\nimport { closePortalMenus } from '../../utils/private.portal/portal.js'\nimport { getScrollTarget, scrollTargetProp } from '../../utils/scroll/scroll.js'\nimport { position, stopAndPrevent } from '../../utils/event/event.js'\nimport { hSlot } from '../../utils/private.render/render.js'\nimport { addEscapeKey, removeEscapeKey } from '../../utils/private.keyboard/escape-key.js'\nimport { addFocusout, removeFocusout } from '../../utils/private.focus/focusout.js'\nimport { childHasFocus } from '../../utils/dom/dom.js'\nimport { addClickOutside, removeClickOutside } from '../../utils/private.click-outside/click-outside.js'\nimport { addFocusFn } from '../../utils/private.focus/focus-manager.js'\n\nimport {\n  validatePosition, validateOffset, setPosition, parsePosition\n} from '../../utils/private.position-engine/position-engine.js'\n\nexport default createComponent({\n  name: 'QMenu',\n\n  inheritAttrs: false,\n\n  props: {\n    ...useAnchorProps,\n    ...useModelToggleProps,\n    ...useDarkProps,\n    ...useTransitionProps,\n\n    persistent: Boolean,\n    autoClose: Boolean,\n    separateClosePopup: Boolean,\n    noEscDismiss: Boolean,\n    noRouteDismiss: Boolean,\n    noRefocus: Boolean,\n    noFocus: Boolean,\n\n    fit: Boolean,\n    cover: Boolean,\n\n    square: Boolean,\n\n    anchor: {\n      type: String,\n      validator: validatePosition\n    },\n    self: {\n      type: String,\n      validator: validatePosition\n    },\n    offset: {\n      type: Array,\n      validator: validateOffset\n    },\n\n    scrollTarget: scrollTargetProp,\n\n    touchPosition: Boolean,\n\n    maxHeight: {\n      type: String,\n      default: null\n    },\n    maxWidth: {\n      type: String,\n      default: null\n    }\n  },\n\n  emits: [\n    ...useModelToggleEmits,\n    'click', 'escapeKey'\n  ],\n\n  setup (props, { slots, emit, attrs }) {\n    let refocusTarget = null, absoluteOffset, unwatchPosition, avoidAutoClose\n\n    const vm = getCurrentInstance()\n    const { proxy } = vm\n    const { $q } = proxy\n\n    const innerRef = ref(null)\n    const showing = ref(false)\n\n    const hideOnRouteChange = computed(() =>\n      props.persistent !== true\n      && props.noRouteDismiss !== true\n    )\n\n    const isDark = useDark(props, $q)\n    const { registerTick, removeTick } = useTick()\n    const { registerTimeout } = useTimeout()\n    const { transitionProps, transitionStyle } = useTransition(props)\n    const { localScrollTarget, changeScrollEvent, unconfigureScrollTarget } = useScrollTarget(props, configureScrollTarget)\n\n    const { anchorEl, canShow } = useAnchor({ showing })\n\n    const { hide } = useModelToggle({\n      showing, canShow, handleShow, handleHide,\n      hideOnRouteChange,\n      processOnMount: true\n    })\n\n    const { showPortal, hidePortal, renderPortal } = usePortal(vm, innerRef, renderPortalContent, 'menu')\n\n    const clickOutsideProps = {\n      anchorEl,\n      innerRef,\n      onClickOutside (e) {\n        if (props.persistent !== true && showing.value === true) {\n          hide(e)\n\n          if (\n            // always prevent touch event\n            e.type === 'touchstart'\n            // prevent click if it's on a dialog backdrop\n            || e.target.classList.contains('q-dialog__backdrop')\n          ) {\n            stopAndPrevent(e)\n          }\n\n          return true\n        }\n      }\n    }\n\n    const anchorOrigin = computed(() =>\n      parsePosition(\n        props.anchor || (\n          props.cover === true ? 'center middle' : 'bottom start'\n        ),\n        $q.lang.rtl\n      )\n    )\n\n    const selfOrigin = computed(() => (\n      props.cover === true\n        ? anchorOrigin.value\n        : parsePosition(props.self || 'top start', $q.lang.rtl)\n    ))\n\n    const menuClass = computed(() =>\n      (props.square === true ? ' q-menu--square' : '')\n      + (isDark.value === true ? ' q-menu--dark q-dark' : '')\n    )\n\n    const onEvents = computed(() => (\n      props.autoClose === true\n        ? { onClick: onAutoClose }\n        : {}\n    ))\n\n    const handlesFocus = computed(() =>\n      showing.value === true && props.persistent !== true\n    )\n\n    watch(handlesFocus, val => {\n      if (val === true) {\n        addEscapeKey(onEscapeKey)\n        addClickOutside(clickOutsideProps)\n      }\n      else {\n        removeEscapeKey(onEscapeKey)\n        removeClickOutside(clickOutsideProps)\n      }\n    })\n\n    function focus () {\n      addFocusFn(() => {\n        let node = innerRef.value\n\n        if (node && (node.contains(document.activeElement) !== true)) {\n          node = node.querySelector('[autofocus][tabindex], [data-autofocus][tabindex]')\n            || node.querySelector('[autofocus] [tabindex], [data-autofocus] [tabindex]')\n            || node.querySelector('[autofocus], [data-autofocus]')\n            || node\n          node.focus({ preventScroll: true })\n        }\n      })\n    }\n\n    function handleShow (evt) {\n      refocusTarget = props.noRefocus === false\n        ? document.activeElement\n        : null\n\n      addFocusout(onFocusout)\n\n      showPortal()\n      configureScrollTarget()\n\n      absoluteOffset = void 0\n\n      if (evt !== void 0 && (props.touchPosition || props.contextMenu)) {\n        const pos = position(evt)\n\n        if (pos.left !== void 0) {\n          const { top, left } = anchorEl.value.getBoundingClientRect()\n          absoluteOffset = { left: pos.left - left, top: pos.top - top }\n        }\n      }\n\n      if (unwatchPosition === void 0) {\n        unwatchPosition = watch(\n          () => $q.screen.width + '|' + $q.screen.height + '|' + props.self + '|' + props.anchor + '|' + $q.lang.rtl,\n          updatePosition\n        )\n      }\n\n      if (props.noFocus !== true) {\n        document.activeElement.blur()\n      }\n\n      // should removeTick() if this gets removed\n      registerTick(() => {\n        updatePosition()\n        props.noFocus !== true && focus()\n      })\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        // required in order to avoid the \"double-tap needed\" issue\n        if ($q.platform.is.ios === true) {\n          // if auto-close, then this click should\n          // not close the menu\n          avoidAutoClose = props.autoClose\n          innerRef.value.click()\n        }\n\n        updatePosition()\n        showPortal(true) // done showing portal\n        emit('show', evt)\n      }, props.transitionDuration)\n    }\n\n    function handleHide (evt) {\n      removeTick()\n      hidePortal()\n\n      anchorCleanup(true)\n\n      if (\n        refocusTarget !== null\n        && (\n          // menu was hidden from code or ESC plugin\n          evt === void 0\n          // menu was not closed from a mouse or touch clickOutside\n          || evt.qClickOutside !== true\n        )\n      ) {\n        ((evt?.type.indexOf('key') === 0\n          ? refocusTarget.closest('[tabindex]:not([tabindex^=\"-\"])')\n          : void 0\n        ) || refocusTarget).focus()\n\n        refocusTarget = null\n      }\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        hidePortal(true) // done hiding, now destroy\n        emit('hide', evt)\n      }, props.transitionDuration)\n    }\n\n    function anchorCleanup (hiding) {\n      absoluteOffset = void 0\n\n      if (unwatchPosition !== void 0) {\n        unwatchPosition()\n        unwatchPosition = void 0\n      }\n\n      if (hiding === true || showing.value === true) {\n        removeFocusout(onFocusout)\n        unconfigureScrollTarget()\n        removeClickOutside(clickOutsideProps)\n        removeEscapeKey(onEscapeKey)\n      }\n\n      if (hiding !== true) {\n        refocusTarget = null\n      }\n    }\n\n    function configureScrollTarget () {\n      if (anchorEl.value !== null || props.scrollTarget !== void 0) {\n        localScrollTarget.value = getScrollTarget(anchorEl.value, props.scrollTarget)\n        changeScrollEvent(localScrollTarget.value, updatePosition)\n      }\n    }\n\n    function onAutoClose (e) {\n      // if auto-close, then the ios double-tap fix which\n      // issues a click should not close the menu\n      if (avoidAutoClose !== true) {\n        closePortalMenus(proxy, e)\n        emit('click', e)\n      }\n      else {\n        avoidAutoClose = false\n      }\n    }\n\n    function onFocusout (evt) {\n      // the focus is not in a vue child component\n      if (\n        handlesFocus.value === true\n        && props.noFocus !== true\n        && childHasFocus(innerRef.value, evt.target) !== true\n      ) {\n        focus()\n      }\n    }\n\n    function onEscapeKey (evt) {\n      if (props.noEscDismiss !== true) {\n        emit('escapeKey')\n        hide(evt)\n      }\n    }\n\n    function updatePosition () {\n      setPosition({\n        targetEl: innerRef.value,\n        offset: props.offset,\n        anchorEl: anchorEl.value,\n        anchorOrigin: anchorOrigin.value,\n        selfOrigin: selfOrigin.value,\n        absoluteOffset,\n        fit: props.fit,\n        cover: props.cover,\n        maxHeight: props.maxHeight,\n        maxWidth: props.maxWidth\n      })\n    }\n\n    function renderPortalContent () {\n      return h(\n        Transition,\n        transitionProps.value,\n        () => (\n          showing.value === true\n            ? h('div', {\n              role: 'menu',\n              ...attrs,\n              ref: innerRef,\n              tabindex: -1,\n              class: [\n                'q-menu q-position-engine scroll' + menuClass.value,\n                attrs.class\n              ],\n              style: [\n                attrs.style,\n                transitionStyle.value\n              ],\n              ...onEvents.value\n            }, hSlot(slots.default))\n            : null\n        )\n      )\n    }\n\n    onBeforeUnmount(anchorCleanup)\n\n    // expose public methods\n    Object.assign(proxy, { focus, updatePosition })\n\n    return renderPortal\n  }\n})\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}